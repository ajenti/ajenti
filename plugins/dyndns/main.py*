from ajenti.ui import *
from ajenti.api import *
from dyndnsconfig import *

class DyndnsPlugin(CategoryPlugin):
    text = 'DynDns'
    icon = '/dl/dyndns/icon.png'
    folder = 'system'

    def get_ui(self):
	ui = self.app.inflate('dyndns:main')
	
	if self._displayDialog != True:
		ui.remove('dialog')

	content = DyndnsConfig(self.app).read()
	self.put_message('info', content)
	return ui

    @event('button/click')
    def on_click(self, event, params, vars):
	self._displayDialog = False
	if(params[0] == 'add'):
		self._displayDialog = True
	pass        

    @event('dialog/submit')
    def on_submit(self, event, params, vars = None):
        if params[0] == 'dialog':
            v = vars.getvalue('value', '')
            if vars.getvalue('action', '') == 'OK':
                dyndnsconfig.Config(self.app).save(vars.getvalue('value', ''))

            self._displayDialog = False
